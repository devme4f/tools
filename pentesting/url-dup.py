#!/usr/bin/env python3
from urllib import parse
import sys

if len(sys.argv) != 3:
        exit(f'Usage: python3 {sys.argv[0]} filename payload')

filename = str(sys.argv[1])
payload = str(sys.argv[2]) # alert(1)

with open(filename, 'r') as f:
        urls = [x.strip() for x in f.read().split('\n')]

def format_url(url, payload):
        u = parse.urlsplit(url)
        key = list(parse.parse_qs(u.query).keys())
        length = len(key)

        blacklist = ['.jpg', '.png', '.svg', '.jpeg', '.gif', '.pdf', '.css', '.js']
        # whitelist = []

        flag = True
        for b in blacklist:
                if b in u.path.lower():
                        flag = False

        if length > 0 and flag:
                d = u.scheme + "://" + u.netloc + u.path
                d += '?' + str(key[0]) + '=' + payload
                if length > 1:
                        for i in range(length-1):
                                d += '&' + key[i+1] + '=' + payload
                return d

        return False


results = []

for url in urls:
        act = format_url(url, payload)
        if act:
                results.append(act)

results = list(set(results))

with open(filename + '.done', 'w') as f:
        for r in results:
                f.write(r+'\n')
